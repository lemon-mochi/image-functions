import java.awt.*;
import java.awt.image.BufferedImage;
import javax.imageio.ImageIO;
import javax.swing.*;
import java.io.File;

void frame_operation(BufferedImage image) {
    // Display the image in a JFrame
    //I asked ChatGpt for help on making the window look better
    frame = new JFrame();
    //tells the program to close when x is clicked
    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); 
    frame.getContentPane().add(new JLabel(new ImageIcon(image)));
    frame.pack(); //modifies the size of the window
    frame.setVisible(true); //this shows the window
}

//this code works on ubuntu linux
//I do not know if it will work on other distros or os
//probably will crash on windows
//selecting a file that isn't tiff will crash the program
public class TIFFViewer2 {
    public static void main(String[] args) {
        try {
            boolean flag = true; //used to decide when to quit the program
            boolean prev = false; //this keeps track of whether a previous image exists
            JFrame frame = null; //initialize before starting the loop
            while (flag) { //keep displaying open file box until user quits
                // Display a file chooser dialog to select a file
                JFileChooser fileChooser = new JFileChooser();
                fileChooser.setDialogTitle("Choose a TIFF file");
                int result = fileChooser.showOpenDialog(null);

                // Check if a file was selected
                if (result == JFileChooser.APPROVE_OPTION) {
                    if (prev) 
                        frame.dispose(); //close the previous frame
                    prev = true;
                    File selectedFile = fileChooser.getSelectedFile();

                    // Load the TIFF image using the file path
                    //this is the original image
                    BufferedImage og_image = ImageIO.read(selectedFile);
                    //this will be the new greyscale image
                    BufferedImage modified = new BufferedImage(
                        og_image.getWidth(),
                        og_image.getHeight(),
                        BufferedImage.TYPE_INT_RGB
                    );
                    
                    //this converts the orginal image into greyscale
                    //even though Java was developed by a Canadian, everything here is spelled the American way
                    //examples are color instead of colour and gray instead of grey
                    for (int x = 0; x < og_image.getWidth(); x++) {
                        for (int y = 0; y < og_image.getHeight(); y++) {
                            Color originalColor = new Color(og_image.getRGB(x, y));
                            int grayValue = (int) (0.299 * originalColor.getRed()
                                    + 0.587 * originalColor.getGreen()
                                    + 0.114 * originalColor.getBlue());
                            Color grey_col = new Color(grayValue, grayValue, grayValue);
                            modified.setRGB(x, y, grey_col.getRGB());
                        }
                    }
                    frame_operation(og_image);
                    frame_operation(modified);
                } 
                else { //a file was not selected
                    System.out.println("No file selected");
                    flag = false; //break out of loop
                }
            }
        } 
        catch (Exception e) { 
            e.printStackTrace(); //throw if there is a problem
        }
    }
}